<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Force cache refresh -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>ÿßŸÅÿ∂ŸÑ ÿ¢ÿ¶ÿ±ŸÜ ÿ¥ÿßŸæ ⁄©€åŸÑ⁄©ŸàŸÑ€åŸπÿ± - Afzal Iron Shop Calculator v2.0 FIXED</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#006633">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Iron Calculator">
    <meta name="description" content="Professional calculator for iron shop materials - Calculate steel rods, iron sheets and more">
    <meta name="keywords" content="iron shop, calculator, steel, Pakistan, ÿßŸÅÿ∂ŸÑ ÿ¢ÿ¶ÿ±ŸÜ ÿ¥ÿßŸæ">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='45' fill='%23006633'/%3E%3Ctext x='50' y='60' font-size='40' text-anchor='middle' fill='white'%3Eüîß%3C/text%3E%3C/svg%3E">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Urdu:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }
        
        html, body {
            overflow-x: hidden;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 10px;
            background: #f5f5f5;
            width: 100vw;
            min-height: 100vh;
        }
        .header {
            background: green;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .calculator {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            max-width: 100%;
            width: 100%;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        .row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 40px;
            gap: 10px;
            align-items: end;
            margin-bottom: 15px;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
            box-sizing: border-box;
        }
        .row > div {
            display: flex;
            flex-direction: column;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            max-width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        /* Search Suggestions Dropdown */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: -10%;
            right: -10%;
            width: 120%; /* Make wider than the input field */
            background: white;
            border: 2px solid #4CAF50;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px; /* Further increased height for better visibility */
            overflow-y: auto;
            z-index: 9999; /* Increased z-index to make sure it appears on top of everything */
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            scrollbar-width: thin;
            scrollbar-color: #4CAF50 #f0f0f0;
        }
        
        /* Custom scrollbar for webkit browsers */
        .search-suggestions::-webkit-scrollbar {
            width: 8px;
        }
        
        .search-suggestions::-webkit-scrollbar-track {
            background: #f0f0f0;
            border-radius: 0 0 8px 0;
        }
        
        .search-suggestions::-webkit-scrollbar-thumb {
            background-color: #4CAF50;
            border-radius: 10px;
            border: 2px solid #f0f0f0;
        }
        
        .search-suggestions:not(:empty) {
            display: block !important;
        }
        
        /* Pulse animation for Add Item buttons */
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(103, 58, 183, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(103, 58, 183, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(103, 58, 183, 0);
            }
        }
        
        .search-suggestion-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        
        .search-suggestion-item:hover {
            background: #f0f8ff;
        }
        
        .search-suggestion-item:last-child {
            border-bottom: none;
        }
        
        .search-suggestion-category {
            font-weight: bold;
            color: #666;
            font-size: 12px;
            text-transform: uppercase;
            padding: 5px 10px;
            background-color: #f5f5f5;
        }
        
        .search-input-container {
            position: relative;
            z-index: 9000; /* High z-index for the container */
            width: 100%;
            overflow: visible; /* Ensure wider suggestions are not clipped */
        }
        
        .search-suggestion-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            font-size: 16px;
            background-color: white;
            transition: all 0.2s ease;
            position: relative;
            line-height: 1.4;
            white-space: normal;
            word-break: break-word;
        }
        
        .search-suggestion-item:hover {
            background-color: #e8f5e8;
            color: #006633;
            padding-left: 25px; /* Slight indent on hover for better visual feedback */
            font-weight: bold;
        }
        
        .search-suggestion-item:active {
            background-color: #d4edda;
            transform: scale(0.98);
        }
        .total {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
            color: green;
            text-align: center;
        }
        /* CRITICAL: Grand Total Button Style - EXACT same as Add Item button */
        .grand-total, .total-button-v2 {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white !important;
            padding: 15px 30px !important;
            text-align: center !important;
            border-radius: 25px !important;
            margin: 10px auto !important;
            font-size: 18px !important;
            font-weight: bold !important;
            display: inline-block !important;
            width: auto !important;
            max-width: fit-content !important;
            min-width: auto !important;
            box-sizing: border-box !important;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3) !important;
            border: none !important;
            overflow: visible !important;
        }
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        button:hover::before {
            left: 100%;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        
        .btn-add {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white !important;
            padding: 15px 30px !important;
            font-size: 18px !important;
            border-radius: 25px !important;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3) !important;
        }
        
        .btn-add:hover {
            background: linear-gradient(135deg, #45a049, #4CAF50) !important;
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4) !important;
        }
        
        .btn-clear {
            background: linear-gradient(135deg, #f44336, #d32f2f) !important;
            color: white !important;
            border-radius: 25px !important;
            box-shadow: 0 4px 8px rgba(244, 67, 54, 0.3) !important;
        }
        
        .btn-clear:hover {
            background: linear-gradient(135deg, #d32f2f, #f44336) !important;
            box-shadow: 0 6px 16px rgba(244, 67, 54, 0.4) !important;
        }
        
        .btn-download {
            background: linear-gradient(135deg, #4CAF50, #2E7D32) !important;
            color: white !important;
            border-radius: 25px !important;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3) !important;
        }
        
        .btn-download:hover {
            background: linear-gradient(135deg, #2E7D32, #4CAF50) !important;
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4) !important;
        }
        
        .btn-print {
            background: linear-gradient(135deg, #ff9800, #f57c00) !important;
            color: white !important;
            border-radius: 25px !important;
            box-shadow: 0 4px 8px rgba(255, 152, 0, 0.3) !important;
        }
        
        .btn-print:hover {
            background: linear-gradient(135deg, #f57c00, #ff9800) !important;
            box-shadow: 0 6px 16px rgba(255, 152, 0, 0.4) !important;
        }
        
        .btn-example {
            background: linear-gradient(135deg, #2196F3, #1976D2) !important;
            color: white !important;
            border-radius: 25px !important;
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3) !important;
        }
        
        .btn-example:hover {
            background: linear-gradient(135deg, #1976D2, #2196F3) !important;
            box-shadow: 0 6px 16px rgba(33, 150, 243, 0.4) !important;
        }
        
        /* Action Buttons Layout Fix */
        .action-buttons {
            display: grid !important;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)) !important;
            gap: 8px !important;
            justify-content: center !important;
            margin-top: 15px !important;
            padding: 0 5px !important;
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
        }
        
        .action-buttons button {
            width: 100% !important;
            padding: 12px 15px !important;
            font-size: 15px !important;
            margin: 0 !important;
            white-space: nowrap !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }
        
        /* Input Field Alignment Fix */
        .row select,
        .row input[type="number"] {
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
            margin: 0 !important;
        }
        
        /* Price Text Alignment */
        .row span {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            min-height: 40px !important;
            font-weight: bold !important;
        }
        .remove-btn {
            background: #dc3545;
            padding: 10px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            transition: all 0.3s ease;
        }
        .remove-btn:hover {
            background: #c82333;
            transform: scale(1.1);
        }
        .total {
            animation: pulse 0.5s ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .instruction-box {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border-left: 5px solid #2196F3;
            animation: slideIn 0.5s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            body {
                padding: 5px !important;
                margin: 0 !important;
                width: 100vw !important;
                overflow-x: hidden !important;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .header h2 {
                font-size: 1.4rem;
            }
            
            .header p {
                font-size: 0.9rem;
            }
            
            .calculator {
                padding: 10px !important;
                margin: 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
                overflow-x: hidden !important;
            }
            
            .row {
                display: block !important;
                gap: 0 !important;
            }
            
            .row > div {
                margin-bottom: 15px !important;
                width: 100% !important;
            }
            
            .item-row {
                padding: 15px !important;
                border-radius: 10px !important;
            }
            
            label {
                font-size: 14px !important;
                font-weight: bold !important;
                color: #333 !important;
                margin-bottom: 8px !important;
            }
            
            input, select {
                width: 100% !important;
                padding: 15px !important;
                font-size: 16px !important;
                border: 2px solid #ddd !important;
                border-radius: 8px !important;
                box-sizing: border-box !important;
            }
            
            .total {
                padding: 15px !important;
                font-size: 1.3rem !important;
                margin-top: 10px !important;
                text-align: center !important;
                border-radius: 8px !important;
            }
            
            .remove-btn {
                width: 50px !important;
                height: 50px !important;
                font-size: 1.4rem !important;
                margin: 10px auto !important;
                display: block !important;
            }
            
            .grand-total {
                font-size: 16px !important;
                padding: 12px 25px !important;
                margin: 8px auto !important;
                border-radius: 20px !important;
            }
            
            /* Mobile Action Buttons */
            .action-buttons {
                grid-template-columns: 1fr !important;
                gap: 8px !important;
                padding: 0 5px !important;
                margin-top: 15px !important;
                width: 100% !important;
                overflow: hidden !important;
            }
            
            .action-buttons button {
                font-size: 14px !important;
                padding: 12px 10px !important;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
                overflow: hidden !important;
                white-space: nowrap !important;
                text-overflow: ellipsis !important;
            }
            
            button {
                width: 100% !important;
                margin: 8px 0 !important;
                padding: 15px !important;
                font-size: 16px !important;
            }
            
            /* Force single column for mobile action buttons */
            .action-buttons {
                display: grid !important;
                grid-template-columns: 1fr !important;
                gap: 8px !important;
                padding: 0 !important;
                margin: 10px 0 !important;
                width: 100% !important;
                max-width: 100% !important;
                overflow: hidden !important;
            }
            
            .instruction-box {
                padding: 10px !important;
                margin-bottom: 15px !important;
            }
            
            .instruction-box h3 {
                font-size: 1.1rem !important;
            }
            
            .instruction-box ol {
                font-size: 0.9rem !important;
            }
        }
        
        /* Extra small screens - Force strict no overflow */
        @media (max-width: 480px) {
            * {
                max-width: 100vw !important;
                overflow-x: hidden !important;
                box-sizing: border-box !important;
            }
            
            body {
                padding: 2px !important;
                width: 100vw !important;
            }
            
            .calculator {
                padding: 5px !important;
                width: calc(100vw - 4px) !important;
            }
            
            .action-buttons {
                grid-template-columns: 1fr !important;
                padding: 0 !important;
                margin: 5px 0 !important;
                width: 100% !important;
            }
            
            .action-buttons button {
                padding: 10px 5px !important;
                font-size: 13px !important;
                width: 100% !important;
            }
            
            .grand-total {
                padding: 12px 20px !important;
                font-size: 14px !important;
                margin: 5px auto !important;
                border-radius: 18px !important;
                width: auto !important;
            }
        }
        
        /* Aggressive mobile fix for stubborn devices */
        @media screen and (max-width: 767px) {
            #grandTotal {
                padding: 12px 20px !important;
                font-size: 14px !important;
                width: auto !important;
                max-width: fit-content !important;
                display: inline-block !important;
                margin: 8px auto !important;
                border-radius: 20px !important;
            }
        }
        
        /* Force cache refresh with version */
        .grand-total[id="grandTotal"] {
            padding: 15px 30px !important;
            font-size: 18px !important;
            width: auto !important;
            display: inline-block !important;
            max-width: fit-content !important;
        }
        
        /* NEW CLASS - Bypass all cache issues */
        .total-button-v2 {
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white !important;
            padding: 15px 30px !important;
            text-align: center !important;
            border-radius: 25px !important;
            margin: 10px auto !important;
            font-size: 18px !important;
            font-weight: bold !important;
            display: inline-block !important;
            width: auto !important;
            max-width: fit-content !important;
            min-width: auto !important;
            box-sizing: border-box !important;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3) !important;
            border: none !important;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß ÿßŸÅÿ∂ŸÑ ÿ¢ÿ¶ÿ±ŸÜ ÿ¥ÿßŸæ ⁄©€åŸÑ⁄©ŸàŸÑ€åŸπÿ±</h1>
        <h2>Afzal Iron Shop Calculator</h2>
        <p><strong>Professional Material Calculator for Iron Shops</strong></p>
        <p><strong>ÿ¢ÿ¶ÿ±ŸÜ ÿ¥ÿßŸæ ⁄©€í ŸÑ€å€í Ÿæ€åÿ¥€Å Ÿàÿ±ÿßŸÜ€Å ŸÖŸàÿßÿØ ⁄©€åŸÑ⁄©ŸàŸÑ€åŸπÿ±</strong></p>
    </div>

    <div class="calculator">
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #2196F3;">
            <h3>üìã Instructions / €ÅÿØÿß€åÿßÿ™:</h3>
            <ol>
                <li><strong>Select Material</strong> from dropdown / <strong>ŸÖŸàÿßÿØ ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫</strong></li>
                <li><strong>Enter Price per Unit</strong> in Rs. / <strong>ŸÅ€å €åŸàŸÜŸπ ŸÇ€åŸÖÿ™ ÿØÿßÿÆŸÑ ⁄©ÿ±€å⁄∫</strong></li>
                <li><strong>Enter Quantity</strong> / <strong>ŸÖŸÇÿØÿßÿ± ÿØÿßÿÆŸÑ ⁄©ÿ±€å⁄∫</strong></li>
                <li><strong>Total calculates automatically</strong> / <strong>⁄©ŸÑ ÿÆŸàÿØ⁄©ÿßÿ± ÿ∑Ÿàÿ± Ÿæÿ± ÿ≠ÿ≥ÿßÿ® €ÅŸà ÿ¨ÿßÿ¶€í ⁄Øÿß</strong></li>
                <li><strong>Click "Add New Item"</strong> for more materials / <strong>ŸÖÿ≤€åÿØ ŸÖŸàÿßÿØ ⁄©€í ŸÑ€å€í ŸÜ€åÿß ÿ¢ÿ¶ŸπŸÖ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫</strong></li>
            </ol>
        </div>
        
        <button onclick="addItem()" class="btn-add" style="
            background: linear-gradient(135deg, #673AB7, #512DA8) !important;
            color: white !important;
            font-size: 18px !important;
            padding: 15px 20px !important;
            border-radius: 50px !important;
            box-shadow: 0 4px 8px rgba(103, 58, 183, 0.3) !important;
            margin: 15px auto !important;
            display: block !important;
            width: 100% !important;
            animation: pulse 2s infinite !important;
            transition: all 0.3s ease !important;
        ">‚ûï Add New Item / ŸÜ€åÿß ÿ¢ÿ¶ŸπŸÖ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫</button>
        
        <div id="items-container">
            <!-- Items will be added here -->
        </div>

        <div class="total-button-v2" id="grandTotal" style="
            background: linear-gradient(135deg, #4CAF50, #45a049) !important;
            color: white !important;
            padding: 15px 30px !important;
            text-align: center !important;
            border-radius: 25px !important;
            margin: 10px auto !important;
            font-size: 18px !important;
            font-weight: bold !important;
            display: inline-block !important;
            width: auto !important;
            box-sizing: border-box !important;
            box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3) !important;
            border: none !important;
            max-width: fit-content !important;
            min-width: auto !important;
        ">
            ⁄©ŸÑ ÿ±ŸÇŸÖ / Grand Total: Rs. 0.00
        </div>
        
        <!-- Bottom Add Item Button for mobile usability -->
        <button onclick="addItem()" class="btn-add" style="
            margin: 20px auto !important;
            display: block !important;
            width: 100% !important;
            max-width: 100% !important;
            background: linear-gradient(135deg, #673AB7, #512DA8) !important;
            color: white !important;
            font-size: 18px !important;
            padding: 15px 20px !important;
            border-radius: 50px !important;
            box-shadow: 0 4px 8px rgba(103, 58, 183, 0.3) !important;
            animation: pulse 2s infinite !important;
            transition: all 0.3s ease !important;
        ">‚ûï Add New Item / ŸÜ€åÿß ÿ¢ÿ¶ŸπŸÖ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫</button>

        <div style="text-align: center;">
            <button onclick="clearAll()" class="btn-clear">üóëÔ∏è Clear All / ÿµÿßŸÅ ⁄©ÿ±€å⁄∫</button>
            <button onclick="downloadPdfBill()" class="btn-download" style="background: linear-gradient(135deg, #D32F2F, #B71C1C); padding: 12px 20px;">üìÑ Download Bill PDF / ÿ®ŸÑ Ÿæ€å ⁄à€å ÿß€åŸÅ</button>
            <button onclick="window.print()" class="btn-print">üñ®Ô∏è Print Bill / ÿ®ŸÑ Ÿæÿ±ŸÜŸπ ⁄©ÿ±€å⁄∫</button>
            <button onclick="showExample()" class="btn-example">üìã Show Example / ŸÖÿ´ÿßŸÑ ÿØ€å⁄©⁄æ€å⁄∫</button>
        </div>
    </div>

    <script>
        let itemCount = 0;
        
        const materialCategories = {
            'Steel Rods / ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄àÿ≤': [
                'ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄à 6mm / Steel Rod 6mm - (Rs. 25-30 per piece)',
                'ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄à 8mm / Steel Rod 8mm - (Rs. 40-45 per piece)',
                'ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄à 10mm / Steel Rod 10mm - (Rs. 55-60 per piece)',
                'ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄à 12mm / Steel Rod 12mm - (Rs. 75-80 per piece)',
                'ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄à 16mm / Steel Rod 16mm - (Rs. 120-130 per piece)',
                'ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄à 20mm / Steel Rod 20mm - (Rs. 180-200 per piece)',
                'ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄à 25mm / Steel Rod 25mm - (Rs. 280-300 per piece)',
                'ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄à 32mm / Steel Rod 32mm - (Rs. 450-500 per piece)',
                'ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄à 40mm / Steel Rod 40mm - (Rs. 700-750 per piece)'
            ],
            'Iron Sheets / ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπÿ≥': [
                'ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπ 18 ⁄Ø€åÿ¨ / Iron Sheet 18 Gauge - (Rs. 85-90 per kg)',
                'ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπ 20 ⁄Ø€åÿ¨ / Iron Sheet 20 Gauge - (Rs. 80-85 per kg)',
                'ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπ 22 ⁄Ø€åÿ¨ / Iron Sheet 22 Gauge - (Rs. 75-80 per kg)',
                'ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπ 24 ⁄Ø€åÿ¨ / Iron Sheet 24 Gauge - (Rs. 70-75 per kg)',
                '⁄Ø€åŸÑŸàÿßŸÜÿßÿ¶ÿ≤⁄à ÿ¥€åŸπ / Galvanized Sheet - (Rs. 95-100 per kg)',
                '⁄©ŸàŸÑ⁄à ÿ±ŸàŸÑ⁄à ÿ¥€åŸπ / Cold Rolled Sheet - (Rs. 90-95 per kg)',
                '€ÅÿßŸπ ÿ±ŸàŸÑ⁄à ÿ¥€åŸπ / Hot Rolled Sheet - (Rs. 85-90 per kg)'
            ],
            'Angle Iron / ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ': [
                'ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ 25x25x3mm / Angle Iron 25x25x3mm - (Rs. 65-70 per kg)',
                'ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ 30x30x3mm / Angle Iron 30x30x3mm - (Rs. 70-75 per kg)',
                'ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ 40x40x5mm / Angle Iron 40x40x5mm - (Rs. 75-80 per kg)',
                'ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ 50x50x6mm / Angle Iron 50x50x6mm - (Rs. 80-85 per kg)',
                'ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ 65x65x6mm / Angle Iron 65x65x6mm - (Rs. 85-90 per kg)',
                'ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ 75x75x8mm / Angle Iron 75x75x8mm - (Rs. 90-95 per kg)'
            ],
            'Pipes / Ÿæÿßÿ¶Ÿæÿ≥': [
                'ÿ¨€å ÿ¢ÿ¶€å Ÿæÿßÿ¶Ÿæ 1/2 ÿßŸÜ⁄Ü / GI Pipe 1/2 inch - (Rs. 120-130 per foot)',
                'ÿ¨€å ÿ¢ÿ¶€å Ÿæÿßÿ¶Ÿæ 3/4 ÿßŸÜ⁄Ü / GI Pipe 3/4 inch - (Rs. 150-160 per foot)',
                'ÿ¨€å ÿ¢ÿ¶€å Ÿæÿßÿ¶Ÿæ 1 ÿßŸÜ⁄Ü / GI Pipe 1 inch - (Rs. 180-190 per foot)',
                'ÿ¨€å ÿ¢ÿ¶€å Ÿæÿßÿ¶Ÿæ 1.5 ÿßŸÜ⁄Ü / GI Pipe 1.5 inch - (Rs. 280-300 per foot)',
                'ÿ¨€å ÿ¢ÿ¶€å Ÿæÿßÿ¶Ÿæ 2 ÿßŸÜ⁄Ü / GI Pipe 2 inch - (Rs. 350-380 per foot)',
                'ÿß€åŸÖ ÿß€åÿ≥ Ÿæÿßÿ¶Ÿæ / MS Pipe - (Rs. 95-105 per kg)',
                'ÿ≥⁄©Ÿàÿßÿ¶ÿ± Ÿæÿßÿ¶Ÿæ / Square Pipe - (Rs. 100-110 per kg)'
            ],
            'Channels / ⁄Ü€åŸÜŸÑÿ≤': [
                '⁄Ü€åŸÜŸÑ 75x40x5mm / Channel 75x40x5mm - (Rs. 75-80 per kg)',
                '⁄Ü€åŸÜŸÑ 100x50x6mm / Channel 100x50x6mm - (Rs. 80-85 per kg)',
                '⁄Ü€åŸÜŸÑ 125x65x6mm / Channel 125x65x6mm - (Rs. 85-90 per kg)',
                '⁄Ü€åŸÜŸÑ 150x75x8mm / Channel 150x75x8mm - (Rs. 90-95 per kg)',
                '⁄Ü€åŸÜŸÑ 200x100x8mm / Channel 200x100x8mm - (Rs. 95-100 per kg)'
            ],
            'Beams / ÿ®€åŸÖÿ≤': [
                'ÿ¢ÿ¶€å ÿ®€åŸÖ 100mm / I-Beam 100mm - (Rs. 85-90 per kg)',
                'ÿ¢ÿ¶€å ÿ®€åŸÖ 150mm / I-Beam 150mm - (Rs. 90-95 per kg)',
                'ÿ¢ÿ¶€å ÿ®€åŸÖ 200mm / I-Beam 200mm - (Rs. 95-100 per kg)',
                'ÿ¢ÿ¶€å ÿ®€åŸÖ 250mm / I-Beam 250mm - (Rs. 100-105 per kg)',
                'ÿß€å⁄Ü ÿ®€åŸÖ / H-Beam - (Rs. 105-110 per kg)'
            ],
            'Flat Bars / ŸÅŸÑ€åŸπ ÿ®ÿßÿ±ÿ≤': [
                'ŸÅŸÑ€åŸπ ÿ®ÿßÿ± 25x3mm / Flat Bar 25x3mm - (Rs. 70-75 per kg)',
                'ŸÅŸÑ€åŸπ ÿ®ÿßÿ± 40x5mm / Flat Bar 40x5mm - (Rs. 75-80 per kg)',
                'ŸÅŸÑ€åŸπ ÿ®ÿßÿ± 50x6mm / Flat Bar 50x6mm - (Rs. 80-85 per kg)',
                'ŸÅŸÑ€åŸπ ÿ®ÿßÿ± 75x8mm / Flat Bar 75x8mm - (Rs. 85-90 per kg)',
                'ŸÅŸÑ€åŸπ ÿ®ÿßÿ± 100x10mm / Flat Bar 100x10mm - (Rs. 90-95 per kg)'
            ],
            'Wire & Mesh / ÿ™ÿßÿ± ÿßŸàÿ± ÿ¨ÿßŸÑ€å': [
                'ÿ®ÿßÿ¶ŸÜ⁄àŸÜ⁄Ø Ÿàÿßÿ¶ÿ± / Binding Wire - (Rs. 110-120 per kg)',
                '⁄Ü⁄©ŸÜ ŸÖ€åÿ¥ / Chicken Mesh - (Rs. 95-105 per kg)',
                '⁄Ü€åŸÜ ŸÑŸÜ⁄© / Chain Link - (Rs. 85-95 per kg)',
                'ÿ®ÿßÿ±ÿ® Ÿàÿßÿ¶ÿ± / Barbed Wire - (Rs. 100-110 per kg)',
                'Ÿà€åŸÑ⁄àŸÜ⁄Ø Ÿàÿßÿ¶ÿ± / Welding Wire - (Rs. 150-170 per kg)'
            ]
        };

        // Flatten all materials for easy searching
        const allMaterials = [];
        Object.values(materialCategories).forEach(category => {
            allMaterials.push(...category);
        });        function addItem() {
            itemCount++;
            const container = document.getElementById('items-container');
            
            const itemDiv = document.createElement('div');
            itemDiv.id = `item-${itemCount}`;
            itemDiv.innerHTML = `
                <hr style="margin: 20px 0; border: 2px solid #4CAF50;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <h3 style="color: #2c3e50; margin: 0 0 15px 0;">üì¶ Item #${itemCount}</h3>
                    <div class="row">
                        <div>
                            <label>ŸÖŸàÿßÿØ / Material:</label>
                            <div class="search-input-container" style="position: relative;">
                                <input type="text" id="material-search-${itemCount}" placeholder="üîç Type to search materials..." 
                                       onkeyup="searchMaterials(${itemCount}, this.value); showSearchSuggestions(${itemCount}, this.value)" 
                                       oninput="resetSelection(${itemCount}); showSearchSuggestions(${itemCount}, this.value)"
                                       onfocus="showSearchSuggestions(${itemCount}, this.value)"
                                       onblur="hideSearchSuggestions(${itemCount})"
                                       autocomplete="off"
                                       style="margin-bottom: 5px; width: 100%; position: relative; padding: 12px 15px; 
                                              border: 2px solid #4CAF50; border-radius: 8px; font-size: 16px; 
                                              box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
                                <div id="search-suggestions-${itemCount}" class="search-suggestions"
                                     onmousedown="event.preventDefault()" 
                                     onclick="event.stopPropagation()" 
                                     style="position: absolute; top: 100%; left: 0; right: 0;"></div>
                            </div>
                            <select id="material-${itemCount}" onchange="selectMaterial(${itemCount}, this.value)" 
                                    style="font-size: 14px; position: relative; z-index: 1;">
                                <option value="">ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫ / Select Material</option>
                                <optgroup label="üî© Steel Rods / ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄àÿ≤">
                                    ${materialCategories['Steel Rods / ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄àÿ≤'].map(m => `<option value="${m}">${m}</option>`).join('')}
                                </optgroup>
                                <optgroup label="üìã Iron Sheets / ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπÿ≥">
                                    ${materialCategories['Iron Sheets / ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπÿ≥'].map(m => `<option value="${m}">${m}</option>`).join('')}
                                </optgroup>
                                <optgroup label="üìê Angle Iron / ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ">
                                    ${materialCategories['Angle Iron / ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ'].map(m => `<option value="${m}">${m}</option>`).join('')}
                                </optgroup>
                                <optgroup label="üîß Pipes / Ÿæÿßÿ¶Ÿæÿ≥">
                                    ${materialCategories['Pipes / Ÿæÿßÿ¶Ÿæÿ≥'].map(m => `<option value="${m}">${m}</option>`).join('')}
                                </optgroup>
                                <optgroup label="üìè Channels / ⁄Ü€åŸÜŸÑÿ≤">
                                    ${materialCategories['Channels / ⁄Ü€åŸÜŸÑÿ≤'].map(m => `<option value="${m}">${m}</option>`).join('')}
                                </optgroup>
                                <optgroup label="üèóÔ∏è Beams / ÿ®€åŸÖÿ≤">
                                    ${materialCategories['Beams / ÿ®€åŸÖÿ≤'].map(m => `<option value="${m}">${m}</option>`).join('')}
                                </optgroup>
                                <optgroup label="üìè Flat Bars / ŸÅŸÑ€åŸπ ÿ®ÿßÿ±ÿ≤">
                                    ${materialCategories['Flat Bars / ŸÅŸÑ€åŸπ ÿ®ÿßÿ±ÿ≤'].map(m => `<option value="${m}">${m}</option>`).join('')}
                                </optgroup>
                                <optgroup label="üîó Wire & Mesh / ÿ™ÿßÿ± ÿßŸàÿ± ÿ¨ÿßŸÑ€å">
                                    ${materialCategories['Wire & Mesh / ÿ™ÿßÿ± ÿßŸàÿ± ÿ¨ÿßŸÑ€å'].map(m => `<option value="${m}">${m}</option>`).join('')}
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label>ŸÇ€åŸÖÿ™ / Price per Unit (Rs.):</label>
                            <input type="number" id="price-${itemCount}" placeholder="e.g. 50.00" step="0.01" onchange="calculate()">
                        </div>
                        <div>
                            <label>ŸÖŸÇÿØÿßÿ± / Quantity:</label>
                            <input type="number" id="quantity-${itemCount}" placeholder="e.g. 10" step="0.01" onchange="calculate()">
                        </div>
                        <div>
                            <label>⁄©ŸÑ / Total:</label>
                            <div class="total" id="total-${itemCount}">Rs. 0.00</div>
                        </div>
                        <div>
                            <button class="remove-btn" onclick="removeItem(${itemCount})" title="Remove this item">‚úï</button>
                        </div>
                    </div>
                </div>
            `;
            
            container.appendChild(itemDiv);
        }

        function removeItem(id) {
            const item = document.getElementById(`item-${id}`);
            if (item) {
                item.remove();
                calculate();
            }
        }

        function calculate() {
            let grandTotal = 0;
            
            for (let i = 1; i <= itemCount; i++) {
                const priceInput = document.getElementById(`price-${i}`);
                const quantityInput = document.getElementById(`quantity-${i}`);
                const totalDiv = document.getElementById(`total-${i}`);
                
                if (priceInput && quantityInput && totalDiv) {
                    const price = parseFloat(priceInput.value) || 0;
                    const quantity = parseFloat(quantityInput.value) || 0;
                    const total = price * quantity;
                    
                    totalDiv.textContent = `Rs. ${total.toFixed(2)}`;
                    grandTotal += total;
                }
            }
            
            document.getElementById('grandTotal').textContent = `⁄©ŸÑ ÿ±ŸÇŸÖ / Grand Total: Rs. ${grandTotal.toFixed(2)}`;
        }

        function clearAll() {
            document.getElementById('items-container').innerHTML = '';
            itemCount = 0;
            calculate();
            addItem(); // Add one item automatically
        }

        function showExample() {
            // Clear all first
            clearAll();
            
            // Add example data
            setTimeout(() => {
                // First item - Steel Rod
                document.getElementById(`material-1`).value = materialCategories['Steel Rods / ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄àÿ≤'][2]; // Steel Rod 12mm
                document.getElementById(`material-search-1`).value = 'Steel Rod 12mm';
                document.getElementById(`price-1`).value = '75';
                document.getElementById(`quantity-1`).value = '10';
                
                // Add second item
                addItem();
                setTimeout(() => {
                    document.getElementById(`material-2`).value = materialCategories['Iron Sheets / ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπÿ≥'][2]; // Iron Sheet 22 Gauge
                    document.getElementById(`material-search-2`).value = 'Iron Sheet 22 Gauge';
                    document.getElementById(`price-2`).value = '78';
                    document.getElementById(`quantity-2`).value = '5';
                    
                    // Add third item
                    addItem();
                    setTimeout(() => {
                        document.getElementById(`material-3`).value = materialCategories['Angle Iron / ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ'][2]; // Angle Iron 40x40x5mm
                        document.getElementById(`material-search-3`).value = 'Angle Iron 40x40x5mm';
                        document.getElementById(`price-3`).value = '77';
                        document.getElementById(`quantity-3`).value = '3';
                        calculate();
                    }, 100);
                }, 100);
            }, 100);
        }

        function downloadBill() {
            // Get current date and time
            const now = new Date();
            const date = now.toLocaleDateString('en-GB');
            const time = now.toLocaleTimeString('en-GB', { hour12: false });
            
            // Generate readable bill content
            let billContent = `
************************************************************
                    AFZAL IRON SHOP
                     ÿßŸÅÿ∂ŸÑ ÿ¢ÿ¶ÿ±ŸÜ ÿ¥ÿßŸæ
************************************************************
Date: ${date}                    Time: ${time}
************************************************************
                        BILL / ÿ®ŸÑ
************************************************************

ITEMS PURCHASED:
`;

            let itemFound = false;
            let grandTotal = 0;

            // Add items to bill
            for (let i = 1; i <= itemCount; i++) {
                const materialSelect = document.getElementById(`material-${i}`);
                const priceInput = document.getElementById(`price-${i}`);
                const quantityInput = document.getElementById(`quantity-${i}`);
                
                if (materialSelect && priceInput && quantityInput) {
                    const material = materialSelect.value;
                    const price = parseFloat(priceInput.value) || 0;
                    const quantity = parseFloat(quantityInput.value) || 0;
                    const total = price * quantity;
                    
                    if (material && price > 0 && quantity > 0) {
                        itemFound = true;
                        grandTotal += total;
                        
                        // Clean material name (remove price hints)
                        const cleanMaterial = material.split(' - ')[0];
                        
                        billContent += `
${i}. Material: ${cleanMaterial}
   Unit Price: Rs. ${price.toFixed(2)}
   Quantity: ${quantity}
   Line Total: Rs. ${total.toFixed(2)}
   ----------------------------------------------------`;
                    }
                }
            }

            if (!itemFound) {
                alert('No items found! Please add some materials first.\n⁄©Ÿàÿ¶€å ÿ¢ÿ¶ŸπŸÖ ŸÜ€Å€å⁄∫ ŸÖŸÑÿß! Ÿæ€ÅŸÑ€í ⁄©⁄Ü⁄æ ŸÖŸàÿßÿØ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫€î');
                return;
            }

            // Add grand total
            billContent += `

************************************************************
                    GRAND TOTAL: Rs. ${grandTotal.toFixed(2)}
                     ⁄©ŸÑ ÿ±ŸÇŸÖ: Rs. ${grandTotal.toFixed(2)}
************************************************************

Thank you for your business!
ÿ¢Ÿæ ⁄©€í ⁄©ÿßÿ±Ÿàÿ®ÿßÿ± ⁄©€í ŸÑ€å€í ÿ¥⁄©ÿ±€å€Å!

Contact: Afzal Iron Shop
Address: [Your Shop Address]
Phone: [Your Phone Number]

Generated by Afzal Iron Shop Calculator
************************************************************
`;

            // Create and download file with proper encoding
            const blob = new Blob([billContent], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `Afzal-Iron-Shop-Bill-${date.replace(/\//g, '-')}-${time.replace(/:/g, '-')}.txt`;
            
            // Trigger download
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
            
            // Show success message
            alert('Bill downloaded successfully! / ÿ®ŸÑ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ⁄àÿßÿ§ŸÜ ŸÑŸà⁄à €ÅŸà ⁄Ø€åÿß!');
            
            // Save to localStorage as backup
            saveBillToStorage(billContent, grandTotal);
        }

        function downloadPdfBill() {
            // Check if any items have been added
            let itemFound = false;
            let grandTotal = 0;
            let itemsList = [];

            // Get current date and time
            const now = new Date();
            const date = now.toLocaleDateString('en-GB');
            const time = now.toLocaleTimeString('en-GB', { hour12: false });

            // Collect items data
            for (let i = 1; i <= itemCount; i++) {
                const materialSelect = document.getElementById(`material-${i}`);
                const priceInput = document.getElementById(`price-${i}`);
                const quantityInput = document.getElementById(`quantity-${i}`);
                
                if (materialSelect && priceInput && quantityInput) {
                    const material = materialSelect.value;
                    const price = parseFloat(priceInput.value) || 0;
                    const quantity = parseFloat(quantityInput.value) || 0;
                    const total = price * quantity;
                    
                    if (material && price > 0 && quantity > 0) {
                        itemFound = true;
                        grandTotal += total;
                        
                        // Clean material name (remove price hints)
                        const cleanMaterial = material.split(' - ')[0];
                        
                        itemsList.push({
                            id: i,
                            material: cleanMaterial,
                            price: price,
                            quantity: quantity,
                            total: total
                        });
                    }
                }
            }

            if (!itemFound) {
                alert('No items found! Please add some materials first.\n⁄©Ÿàÿ¶€å ÿ¢ÿ¶ŸπŸÖ ŸÜ€Å€å⁄∫ ŸÖŸÑÿß! Ÿæ€ÅŸÑ€í ⁄©⁄Ü⁄æ ŸÖŸàÿßÿØ ÿ¥ÿßŸÖŸÑ ⁄©ÿ±€å⁄∫€î');
                return;
            }

            // Create PDF with better quality
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: "portrait",
                unit: "mm",
                format: "a4",
                compress: false // Better quality
            });
            
            // Set font size and style
            doc.setFont("Helvetica", "bold");
            doc.setFontSize(22); // Larger font
            
            // Add header with better styling
            doc.setTextColor(0, 102, 51); // Dark green color
            doc.text("AFZAL IRON SHOP", 105, 20, { align: "center" });
            doc.setFontSize(16); // Larger font for Urdu
            doc.text("ÿßŸÅÿ∂ŸÑ ÿ¢ÿ¶ÿ±ŸÜ ÿ¥ÿßŸæ", 105, 30, { align: "center" });
            
            // Add divider with thicker line
            doc.setDrawColor(0, 102, 51);
            doc.setLineWidth(0.8); // Thicker line
            doc.line(20, 35, 190, 35);
            
            // Add bill details with better formatting
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12); // Larger font
            doc.setFont("Helvetica", "normal");
            doc.text(`Date: ${date}`, 20, 45);
            doc.text(`Time: ${time}`, 170, 45);
            doc.text(`Bill #: ${Date.now().toString().substring(7)}`, 20, 52);
            
            // Add column headers with better styling
            doc.setFont("Helvetica", "bold");
            doc.setFillColor(235, 245, 235); // Light green background
            doc.rect(20, 58, 170, 10, "F"); // Taller header
            doc.setTextColor(0, 80, 40); // Darker green text
            doc.text("No.", 25, 65);
            doc.text("Material", 45, 65);
            doc.text("Unit Price (Rs.)", 110, 65);
            doc.text("Quantity", 145, 65);
            doc.text("Total (Rs.)", 175, 65);
            
            // Add items with improved styling
            doc.setFont("Helvetica", "normal");
            doc.setTextColor(0, 0, 0); // Black text for items
            doc.setFontSize(11); // Larger font for better readability
            let y = 75; // Start items lower for better spacing
            
            // Add zebra striping for better readability
            itemsList.forEach((item, index) => {
                // Add zebra striping (alternate row colors)
                if (index % 2 === 0) {
                    doc.setFillColor(248, 248, 248);
                    doc.rect(20, y-5, 170, 9, "F");
                }
                
                doc.text(item.id.toString(), 25, y);
                
                // Handle long material names
                const materialName = item.material;
                if (materialName.length > 35) { // Shortened to prevent overflow
                    doc.text(materialName.substring(0, 32) + "...", 45, y);
                } else {
                    doc.text(materialName, 45, y);
                }
                
                // Right align numbers for better readability
                doc.text(item.price.toFixed(2), 120, y, { align: "right" });
                doc.text(item.quantity.toString(), 150, y, { align: "right" });
                doc.setFont("Helvetica", "bold"); // Make total bold
                doc.text(item.total.toFixed(2), 185, y, { align: "right" });
                doc.setFont("Helvetica", "normal"); // Reset to normal
                
                // Add divider line
                doc.setDrawColor(200, 220, 200); // Light green divider
                doc.setLineWidth(0.2); // Slightly thicker for better visibility
                doc.line(20, y + 4, 190, y + 4);
                
                y += 10; // More space between rows
                
                // Add new page if needed with better formatting
                if (y > 250) { // Leave more room at bottom
                    doc.addPage();
                    // Add header to new page
                    doc.setTextColor(0, 102, 51); // Dark green color
                    doc.setFont("Helvetica", "bold");
                    doc.setFontSize(16);
                    doc.text("AFZAL IRON SHOP - Bill Continued", 105, 20, { align: "center" });
                    doc.setDrawColor(0, 102, 51);
                    doc.setLineWidth(0.8);
                    doc.line(20, 25, 190, 25);
                    
                    // Add column headers again on new page
                    doc.setFillColor(235, 245, 235);
                    doc.rect(20, 30, 170, 10, "F");
                    doc.setFontSize(12);
                    doc.text("No.", 25, 37);
                    doc.text("Material", 45, 37);
                    doc.text("Unit Price (Rs.)", 110, 37);
                    doc.text("Quantity", 145, 37);
                    doc.text("Total (Rs.)", 175, 37);
                    
                    doc.setFont("Helvetica", "normal");
                    doc.setFontSize(11);
                    doc.setTextColor(0, 0, 0);
                    y = 50; // Start items at appropriate position on new page
                }
            });
            
            // Add total with better styling
            doc.setDrawColor(0, 102, 51);
            doc.setLineWidth(1.0); // Thicker line for total
            doc.line(20, y + 3, 190, y + 3);
            
            // Add total background
            doc.setFillColor(235, 245, 235);
            doc.rect(110, y + 5, 80, 12, "F");
            
            // Add total text
            doc.setFont("Helvetica", "bold");
            doc.setFontSize(14); // Larger font for total
            doc.setTextColor(0, 80, 40);
            doc.text("Grand Total:", 140, y + 13);
            doc.text(`Rs. ${grandTotal.toFixed(2)}`, 185, y + 13, { align: "right" });
            
            // Add footer with better styling
            y += 25;
            doc.setDrawColor(0, 102, 51);
            doc.setLineWidth(0.8);
            doc.line(20, y, 190, y);
            
            // Add thank you message with better styling
            doc.setFont("Helvetica", "normal");
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.text("Thank you for your business! / ÿ¢Ÿæ ⁄©€í ⁄©ÿßÿ±Ÿàÿ®ÿßÿ± ⁄©€í ŸÑ€å€í ÿ¥⁄©ÿ±€å€Å!", 105, y + 10, { align: "center" });
            
            // Add contact info with better styling
            doc.setFontSize(10);
            doc.text("Contact: Afzal Iron Shop", 105, y + 18, { align: "center" });
            doc.text("Address: Main Market, Lahore, Pakistan", 105, y + 25, { align: "center" });
            doc.text("Phone: +92 3XX XXXXXXX", 105, y + 32, { align: "center" });
            
            // Add generator info with subtle styling
            doc.setFontSize(8);
            doc.setTextColor(100, 100, 100); // Gray text
            doc.text("Generated by Afzal Iron Shop Calculator", 105, y + 42, { align: "center" });
            
            // Add current date and time at bottom right
            doc.text(`Generated on: ${date} at ${time}`, 190, 285, { align: "right" });
            
            // Save PDF with clearer filename
            doc.save(`Afzal-Iron-Shop-Bill-${date.replace(/\//g, '-')}.pdf`);
            
            // Show success message
            alert('Bill PDF downloaded successfully! / ÿ®ŸÑ Ÿæ€å ⁄à€å ÿß€åŸÅ ⁄©ÿßŸÖ€åÿßÿ®€å ÿ≥€í ⁄àÿßÿ§ŸÜ ŸÑŸà⁄à €ÅŸà ⁄Ø€åÿß!');
            
            // Save to localStorage as backup
            saveBillToStorage(doc.output(), grandTotal);
        }

        function saveBillToStorage(billContent, total) {
            try {
                const bills = JSON.parse(localStorage.getItem('afzalIronShopBills') || '[]');
                const newBill = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    content: billContent,
                    total: total,
                    timestamp: new Date().toLocaleString()
                };
                
                bills.unshift(newBill); // Add to beginning
                
                // Keep only last 50 bills
                if (bills.length > 50) {
                    bills.splice(50);
                }
                
                localStorage.setItem('afzalIronShopBills', JSON.stringify(bills));
            } catch (error) {
                console.log('Could not save to localStorage:', error);
            }
        }

        function searchMaterials(itemId, searchTerm) {
            const select = document.getElementById(`material-${itemId}`);
            const searchInput = document.getElementById(`material-search-${itemId}`);
            
            if (searchTerm.length === 0) {
                // Show all categories when search is empty
                populateAllCategories(select);
                return;
            }
            
            // Clear existing options
            select.innerHTML = '<option value="">ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫ / Select Material</option>';
            
            // Improved filtering - search in both English and Urdu, and in material details
            const filteredMaterials = [];
            const searchLower = searchTerm.toLowerCase();
            
            Object.keys(materialCategories).forEach(categoryName => {
                materialCategories[categoryName].forEach(material => {
                    // Search in material name, category name, and common terms
                    const materialLower = material.toLowerCase();
                    const categoryLower = categoryName.toLowerCase();
                    
                    // Check if search term matches:
                    // 1. Material name
                    // 2. Category name  
                    // 3. Size/dimensions (like 12mm, 22 gauge, etc.)
                    // 4. Common terms (steel, iron, rod, sheet, etc.)
                    if (materialLower.includes(searchLower) || 
                        categoryLower.includes(searchLower) ||
                        material.includes(searchTerm) ||
                        categoryName.includes(searchTerm)) {
                        filteredMaterials.push({
                            material: material,
                            category: categoryName
                        });
                    }
                });
            });
            
            // Group by category for better organization
            const groupedResults = {};
            filteredMaterials.forEach(item => {
                if (!groupedResults[item.category]) {
                    groupedResults[item.category] = [];
                }
                groupedResults[item.category].push(item.material);
            });
            
            // Add grouped results to select
            Object.keys(groupedResults).forEach(categoryName => {
                const optgroup = document.createElement('optgroup');
                const icons = {
                    'Steel Rods / ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄àÿ≤': 'üî©',
                    'Iron Sheets / ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπÿ≥': 'üìã',
                    'Angle Iron / ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ': 'üìê',
                    'Pipes / Ÿæÿßÿ¶Ÿæÿ≥': 'üîß',
                    'Channels / ⁄Ü€åŸÜŸÑÿ≤': 'üìè',
                    'Beams / ÿ®€åŸÖÿ≤': 'üèóÔ∏è',
                    'Flat Bars / ŸÅŸÑ€åŸπ ÿ®ÿßÿ±ÿ≤': 'üìè',
                    'Wire & Mesh / ÿ™ÿßÿ± ÿßŸàÿ± ÿ¨ÿßŸÑ€å': 'üîó'
                };
                optgroup.label = `${icons[categoryName] || 'üì¶'} ${categoryName}`;
                
                groupedResults[categoryName].forEach(material => {
                    const option = document.createElement('option');
                    option.value = material;
                    option.textContent = material;
                    optgroup.appendChild(option);
                });
                
                select.appendChild(optgroup);
            });
            
            // Show message if no results
            if (filteredMaterials.length === 0) {
                const option = document.createElement('option');
                option.value = '';
                option.textContent = `No results for "${searchTerm}" / "${searchTerm}" ⁄©€í ŸÑ€å€í ⁄©Ÿàÿ¶€å ŸÜÿ™€åÿ¨€Å ŸÜ€Å€å⁄∫`;
                option.disabled = true;
                select.appendChild(option);
            }
        }

        function showMaterialDropdown(itemId) {
            const select = document.getElementById(`material-${itemId}`);
            const searchInput = document.getElementById(`material-search-${itemId}`);
            
            if (searchInput.value === '') {
                populateAllCategories(select);
            }
        }

        function populateAllCategories(select) {
            select.innerHTML = '<option value="">ŸÖŸÜÿ™ÿÆÿ® ⁄©ÿ±€å⁄∫ / Select Material</option>';
            
            Object.keys(materialCategories).forEach(categoryName => {
                const optgroup = document.createElement('optgroup');
                const icons = {
                    'Steel Rods / ÿ≥Ÿπ€åŸÑ ÿ±ÿß⁄àÿ≤': 'üî©',
                    'Iron Sheets / ÿ¢ÿ¶ÿ±ŸÜ ÿ¥€åŸπÿ≥': 'üìã',
                    'Angle Iron / ÿß€åŸÜ⁄ØŸÑ ÿ¢ÿ¶ÿ±ŸÜ': 'üìê',
                    'Pipes / Ÿæÿßÿ¶Ÿæÿ≥': 'üîß',
                    'Channels / ⁄Ü€åŸÜŸÑÿ≤': 'üìè',
                    'Beams / ÿ®€åŸÖÿ≤': 'üèóÔ∏è',
                    'Flat Bars / ŸÅŸÑ€åŸπ ÿ®ÿßÿ±ÿ≤': 'üìè',
                    'Wire & Mesh / ÿ™ÿßÿ± ÿßŸàÿ± ÿ¨ÿßŸÑ€å': 'üîó'
                };
                optgroup.label = `${icons[categoryName] || 'üì¶'} ${categoryName}`;
                
                materialCategories[categoryName].forEach(material => {
                    const option = document.createElement('option');
                    option.value = material;
                    option.textContent = material;
                    optgroup.appendChild(option);
                });
                
                select.appendChild(optgroup);
            });
        }

        function selectMaterial(itemId, value) {
            // When user selects from dropdown, update search box only if there's a selection
            const searchInput = document.getElementById(`material-search-${itemId}`);
            if (value) {
                // Extract material name without price info for search field
                const materialName = value.split(' - ')[0];
                searchInput.value = materialName;
            } else {
                // Clear search box if no selection
                searchInput.value = '';
            }
            // Always recalculate when selection changes
            calculate();
        }

        function resetSelection(itemId) {
            // Reset dropdown selection when user types in search box
            const select = document.getElementById(`material-${itemId}`);
            select.value = '';
        }

        // New Search Suggestions Functions
        function showSearchSuggestions(itemId, searchTerm) {
            const suggestionsContainer = document.getElementById(`search-suggestions-${itemId}`);
            
            if (!searchTerm || searchTerm.length === 0) {
                suggestionsContainer.innerHTML = '';
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            // Filter materials for suggestions
            const suggestions = [];
            const searchLower = searchTerm.toLowerCase();
            
            Object.keys(materialCategories).forEach(categoryName => {
                const categoryMatches = [];
                materialCategories[categoryName].forEach(material => {
                    const materialLower = material.toLowerCase();
                    if (materialLower.includes(searchLower) || 
                        material.includes(searchTerm)) {
                        categoryMatches.push(material);
                    }
                });
                
                if (categoryMatches.length > 0) {
                    suggestions.push({
                        category: categoryName,
                        materials: categoryMatches.slice(0, 5) // Limit to 5 per category
                    });
                }
            });
            
            // Build suggestions HTML
            let suggestionsHTML = '';
            suggestions.forEach(group => {
                if (suggestionsHTML) suggestionsHTML += '<hr style="margin: 5px 0; border: 1px solid #f0f0f0;">';
                suggestionsHTML += `<div class="search-suggestion-category">${group.category}</div>`;
                group.materials.forEach(material => {
                    const materialName = material.split(' - ')[0]; // Remove price info
                    suggestionsHTML += `
                        <div class="search-suggestion-item" 
                             onmousedown="selectSuggestion(${itemId}, '${material}', '${materialName}')">
                            ${material}
                        </div>`;
                });
            });
            
            if (suggestions.length === 0) {
                suggestionsHTML = `<div class="search-suggestion-item" style="color: #999;">No results for "${searchTerm}"</div>`;
            }
            
            suggestionsContainer.innerHTML = suggestionsHTML;
            suggestionsContainer.style.display = 'block';
            
            // Force the suggestions to appear in front of everything
            suggestionsContainer.style.zIndex = '9999';
            
            // Bring container to front
            const searchContainer = document.getElementById(`material-search-${itemId}`).parentNode;
            if (searchContainer) {
                searchContainer.style.zIndex = '9000';
            }
        }

        function hideSearchSuggestions(itemId) {
            setTimeout(() => {
                const suggestionsContainer = document.getElementById(`search-suggestions-${itemId}`);
                const searchInput = document.getElementById(`material-search-${itemId}`);
                
                // Only hide if the input doesn't have focus or is empty
                if (suggestionsContainer && (document.activeElement !== searchInput || !searchInput.value.trim())) {
                    suggestionsContainer.style.display = 'none';
                }
            }, 200); // Delay to allow click to register
        }

        function selectSuggestion(itemId, fullMaterial, displayName) {
            const searchInput = document.getElementById(`material-search-${itemId}`);
            const select = document.getElementById(`material-${itemId}`);
            
            // Set the search input to show selected material
            searchInput.value = displayName;
            
            // Set the dropdown to the selected material
            select.value = fullMaterial;
            
            // If the select doesn't have this exact value, find closest match
            if (select.value !== fullMaterial) {
                // Find and select the closest match in the dropdown
                for (let i = 0; i < select.options.length; i++) {
                    if (select.options[i].value === fullMaterial || 
                        select.options[i].value.includes(displayName) || 
                        displayName.includes(select.options[i].value)) {
                        select.selectedIndex = i;
                        break;
                    }
                }
            }
            
            // Hide suggestions
            const suggestionsContainer = document.getElementById(`search-suggestions-${itemId}`);
            suggestionsContainer.style.display = 'none';
            
            // Trigger calculation
            calculate();
            
            // Focus back on input and move to the next item
            searchInput.focus();
        }

        // Add first item automatically
        addItem();
    </script>
    
    <!-- PWA Installation Script -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // PWA Install Button Functionality
        let deferredPrompt;
        const installButton = document.createElement('button');
        installButton.textContent = 'üì± Install App / ÿß€åŸæ ÿßŸÜÿ≥ŸπÿßŸÑ ⁄©ÿ±€å⁄∫';
        installButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            cursor: pointer;
            z-index: 1000;
            font-size: 14px;
            display: none;
            animation: pulse 2s infinite;
        `;

        // Add CSS for pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); box-shadow: 0 6px 20px rgba(0,0,0,0.4); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show install button
            installButton.style.display = 'block';
            document.body.appendChild(installButton);
        });

        installButton.addEventListener('click', (e) => {
            // Hide the button
            installButton.style.display = 'none';
            // Show the prompt
            deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the A2HS prompt');
                    alert('App installing... Check your home screen! / ÿß€åŸæ ÿßŸÜÿ≥ŸπÿßŸÑ €ÅŸà ÿ±€Åÿß €Å€í... ÿßŸæŸÜ€å €ÅŸàŸÖ ÿ≥⁄©ÿ±€åŸÜ ⁄Ü€å⁄© ⁄©ÿ±€å⁄∫!');
                } else {
                    console.log('User dismissed the A2HS prompt');
                }
                deferredPrompt = null;
            });
        });

        // Show install instructions for iOS
        function isIOS() {
            return /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        }

        if (isIOS()) {
            const iosInstallButton = document.createElement('div');
            iosInstallButton.innerHTML = `
                <div style="position: fixed; bottom: 20px; left: 20px; background: rgba(0,0,0,0.8); color: white; padding: 15px; border-radius: 10px; font-size: 12px; max-width: 250px; z-index: 1000;">
                    üì± <strong>Install App:</strong><br>
                    Tap <strong>Share</strong> button ‚Üí <strong>Add to Home Screen</strong><br>
                    <button onclick="this.parentElement.style.display='none'" style="background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 5px; margin-top: 10px;">Got it!</button>
                </div>
            `;
            document.body.appendChild(iosInstallButton);
        }
        
        // NUCLEAR CACHE BUSTER - Force Grand Total to correct size
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                const grandTotal = document.getElementById('grandTotal');
                if (grandTotal) {
                    // Force override all styles
                    grandTotal.style.cssText = `
                        background: linear-gradient(135deg, #4CAF50, #45a049) !important;
                        color: white !important;
                        padding: 15px 30px !important;
                        text-align: center !important;
                        border-radius: 25px !important;
                        margin: 10px auto !important;
                        font-size: 18px !important;
                        font-weight: bold !important;
                        display: inline-block !important;
                        width: auto !important;
                        max-width: fit-content !important;
                        min-width: auto !important;
                        box-sizing: border-box !important;
                        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.3) !important;
                        border: none !important;
                    `;
                }
            }, 100);
        });
    </script>
</body>
</html>
